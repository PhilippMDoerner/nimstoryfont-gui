"use strict";(self.webpackChunknimstoryfont_gui=self.webpackChunknimstoryfont_gui||[]).push([[4307],{"./node_modules/@ngrx/operators/fesm2022/ngrx-operators.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Hn:()=>tapResponse});var rxjs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/empty.js"),rxjs_operators__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/tap.js"),rxjs_operators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),rxjs_operators__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/finalize.js");function tapResponse(observerOrNext,error,complete){const observer="function"==typeof observerOrNext?{next:observerOrNext,error,complete}:observerOrNext;return source=>source.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_0__.M)({next:observer.next,complete:observer.complete}),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_1__.W)((error=>(observer.error(error),rxjs__WEBPACK_IMPORTED_MODULE_2__.w))),observer.finalize?(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_3__.j)(observer.finalize):source$=>source$)}},"./node_modules/@ngrx/signals/fesm2022/ngrx-signals.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Eu:()=>signalStore,M8:()=>patchState,Mj:()=>signalStoreFeature,Q2:()=>withState,QO:()=>withComputed,RI:()=>withMethods,TK:()=>withHooks});var _angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs");function toDeepSignal(signal){const value=(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.untracked)((()=>signal()));return function isRecord(value){return value?.constructor===Object}(value)?new Proxy(signal,{get:(target,prop)=>prop in value?((0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.isSignal)(target[prop])||Object.defineProperty(target,prop,{value:(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.computed)((()=>target()[prop])),configurable:!0}),toDeepSignal(target[prop])):target[prop]}):signal}const STATE_WATCHERS=new WeakMap,STATE_SOURCE=Symbol("STATE_SOURCE");function patchState(stateSource,...updaters){stateSource[STATE_SOURCE].update((currentState=>updaters.reduce(((nextState,updater)=>({...nextState,..."function"==typeof updater?updater(nextState):updater})),currentState))),function notifyWatchers(stateSource){const watchers=getWatchers(stateSource);for(const watcher of watchers){watcher((0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.untracked)((()=>getState(stateSource))))}}(stateSource)}function getState(stateSource){return stateSource[STATE_SOURCE]()}function getWatchers(stateSource){return STATE_WATCHERS.get(stateSource[STATE_SOURCE])||[]}function signalStore(...args){const signalStoreArgs=[...args],config="function"==typeof signalStoreArgs[0]?{}:signalStoreArgs.shift(),features=signalStoreArgs;class SignalStore{constructor(){const innerStore=features.reduce(((store,feature)=>feature(store)),function getInitialInnerStore(){return{[STATE_SOURCE]:(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.signal)({}),stateSignals:{},computedSignals:{},methods:{},hooks:{}}}()),{stateSignals,computedSignals,methods,hooks}=innerStore,storeMembers={...stateSignals,...computedSignals,...methods};this[STATE_SOURCE]=innerStore[STATE_SOURCE];for(const key in storeMembers)this[key]=storeMembers[key];const{onInit,onDestroy}=hooks;onInit&&onInit(),onDestroy&&(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.inject)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.DestroyRef).onDestroy(onDestroy)}static ɵfac=function SignalStore_Factory(__ngFactoryType__){return new(__ngFactoryType__||SignalStore)};static ɵprov=_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineInjectable"]({token:SignalStore,factory:SignalStore.ɵfac,providedIn:config.providedIn||null})}return("undefined"==typeof ngDevMode||ngDevMode)&&_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵsetClassMetadata"](SignalStore,[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Injectable,args:[{providedIn:config.providedIn||null}]}],(()=>[]),null),SignalStore}function signalStoreFeature(featureOrInput,...restFeatures){const features="function"==typeof featureOrInput?[featureOrInput,...restFeatures]:restFeatures;return inputStore=>features.reduce(((store,feature)=>feature(store)),inputStore)}function assertUniqueStoreMembers(store,newMemberKeys){if(!ngDevMode)return;const storeMembers={...store.stateSignals,...store.computedSignals,...store.methods},overriddenKeys=Object.keys(storeMembers).filter((memberKey=>newMemberKeys.includes(memberKey)));overriddenKeys.length>0&&console.warn("@ngrx/signals: SignalStore members cannot be overridden.","Trying to override:",overriddenKeys.join(", "))}function withComputed(signalsFactory){return store=>{const computedSignals=signalsFactory({...store.stateSignals,...store.computedSignals});return assertUniqueStoreMembers(store,Object.keys(computedSignals)),{...store,computedSignals:{...store.computedSignals,...computedSignals}}}}function withHooks(hooksOrFactory){return store=>{const storeMembers={[STATE_SOURCE]:store[STATE_SOURCE],...store.stateSignals,...store.computedSignals,...store.methods},hooks="function"==typeof hooksOrFactory?hooksOrFactory(storeMembers):hooksOrFactory,createHook=name=>{const hook=hooks[name],currentHook=store.hooks[name];return hook?()=>{currentHook&&currentHook(),hook(storeMembers)}:currentHook};return{...store,hooks:{onInit:createHook("onInit"),onDestroy:createHook("onDestroy")}}}}function withMethods(methodsFactory){return store=>{const methods=methodsFactory({[STATE_SOURCE]:store[STATE_SOURCE],...store.stateSignals,...store.computedSignals,...store.methods});return assertUniqueStoreMembers(store,Object.keys(methods)),{...store,methods:{...store.methods,...methods}}}}function withState(stateOrFactory){return store=>{const state="function"==typeof stateOrFactory?stateOrFactory():stateOrFactory,stateKeys=Object.keys(state);assertUniqueStoreMembers(store,stateKeys),store[STATE_SOURCE].update((currentState=>({...currentState,...state})));const stateSignals=stateKeys.reduce(((acc,key)=>{const sliceSignal=(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.computed)((()=>store[STATE_SOURCE]()[key]));return{...acc,[key]:toDeepSignal(sliceSignal)}}),{});return{...store,stateSignals:{...store.stateSignals,...stateSignals}}}}},"./src/app/_models/token.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{u:()=>CampaignRoles});const CampaignRoles=["member","admin","guest","globalguest","globalmember"]},"./src/app/_services/base.service.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{d:()=>BaseService});var tslib__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),_angular_common_http__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@angular/common/fesm2022/http.mjs"),_angular_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),rxjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),src_environments_environment__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/environments/environment.ts");let BaseService=class BaseService{constructor(http,baseUrl){this.http=http,this.apiUrl=src_environments_environment__WEBPACK_IMPORTED_MODULE_0__.c.apiUrl,this.baseUrl=`${this.apiUrl}/${baseUrl}`}list(){return this.http.get(`${this.baseUrl}/`).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_1__.T)((entries=>entries.map((entry=>this.parseEntity(entry))))))}campaignList(campaign){return this.http.get(`${this.baseUrl}/${campaign}/overview/`).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_1__.T)((entries=>entries.map((entry=>this.parseOverviewEntity(entry))))))}campaignDetailList(campaign){return this.http.get(`${this.baseUrl}/${campaign}/`).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_1__.T)((entries=>entries.map((entry=>this.parseEntity(entry))))))}create(data){return this.http.post(`${this.baseUrl}/`,data).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_1__.T)((entry=>this.parseEntity(entry))))}update(pk,data){return this.http.put(`${this.baseUrl}/pk/${pk}/`,data).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_1__.T)((entry=>this.parseEntity(entry))))}read(pk){return this.http.get(`${this.baseUrl}/pk/${pk}/`).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_1__.T)((entry=>this.parseEntity(entry))))}readByParam(campaign,params){if("string"!=typeof params.name)throw console.error("The params you used in the service"),console.error(params),'Invalid params exception. You tried to use the base readByParams of GenericService with a parameter \n      object without the "name" attribute. This indicates your call is more complex than \n      this base implementation is useful for. Overwrite readByParam in the service that inherits from  \n      GenericObjectService and implement the function yourself';return this.http.get(`${this.baseUrl}/${campaign}/${params.name}/`).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_1__.T)((entry=>this.parseEntity(entry))))}delete(pk){return this.http.delete(`${this.baseUrl}/pk/${pk}/`)}patch(pk,data){return this.http.patch(`${this.baseUrl}/pk/${pk}/`,data).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_1__.T)((entry=>this.parseEntity(entry))))}sortList(entries,sortProperty){return entries.sort(((a,b)=>{const aVal=a[sortProperty],bVal=b[sortProperty];return aVal===bVal?0:null==aVal?-1:null==bVal||aVal>bVal?1:-1}))}static{this.ctorParameters=()=>[{type:_angular_common_http__WEBPACK_IMPORTED_MODULE_2__.Qq},{type:String}]}};BaseService=(0,tslib__WEBPACK_IMPORTED_MODULE_3__.Cg)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_4__.Injectable)({providedIn:"root"})],BaseService)},"./src/app/_services/routing.service.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>RoutingService});var RoutingService_1,tslib__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),_angular_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),_angular_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@angular/router/fesm2022/router.mjs"),src_utils_logging__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/utils/logging.ts"),src_utils_object__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/utils/object.ts");let RoutingService=class RoutingService{static{RoutingService_1=this}constructor(router){this.router=router,this.NONE_STRING="None",this.routeNodes=this.getRouteTree(),(0,src_utils_logging__WEBPACK_IMPORTED_MODULE_0__.R)(`${RoutingService_1.name}-routeNodes`,this.routeNodes)}routeToPath(routeName,params){(0,src_utils_logging__WEBPACK_IMPORTED_MODULE_0__.R)(RoutingService_1.name,`Routing to ${routeName}`);const routePath=this.getRoutePath(routeName,params),cleanedObjectUrl=this.replaceSpecialUnicodeCharacters(routePath);this.router.navigateByUrl(cleanedObjectUrl)}getRoutePath(routeName,params={}){let variableRoutePath=this.getVariableRoutePathByName(routeName);if(this.hasPathVariables(variableRoutePath)){const variableNames=this.getPathVariableNames(variableRoutePath);for(let variableName of variableNames){const propertyKey=(0,src_utils_object__WEBPACK_IMPORTED_MODULE_1__.Ui)(params,variableName);if(null!=propertyKey)null===params[propertyKey]&&(params[propertyKey]=this.NONE_STRING),variableRoutePath=variableRoutePath.replace(`:${variableName}`,params[propertyKey]);else{const e=new Error(`Tried to create path for route '${routeName}' but lacked parameter '${variableName}' `);console.error(e,"Provided Params: ",params)}}}return`/${variableRoutePath}`}routeToErrorPage(error){if("number"!=typeof error&&!error.hasOwnProperty("status"))throw"Incorrect error input. The input does not contain an error status or an object with the error status. Can not route to error page without error status.";"number"!=typeof error&&error.hasOwnProperty("status")&&(error=error.status);const errorStatusParam=`${error}`;this.routeToPath("error",{errorStatus:errorStatusParam})}routeNameMatches(route,routeName){return route.snapshot.data.name===routeName}replaceSpecialUnicodeCharacters(routePath){return routePath.replace("(","%28").replace(")","%29").replace("?","?").replace("†","%E2%80%A0")}getVariableRoutePathByName(routeName){return this.getVariableRouteByName(routeName).fullPath}getVariableRouteByName(routeName){const route=this.routeNodes[routeName];if(null==route)throw`There is no route with the name ${routeName}. Please contact the Developer to use either a different route name or create a route for this name.`;return route}hasPathVariables(routePath){return routePath.includes("/:")}hasRoutePath(routeName){return null!=this.routeNodes[routeName]}getEndRoutes(route,parentPath=""){let path="";parentPath&&route.path?path=`${parentPath}/${route.path}`:parentPath?path=parentPath:route.path&&(path=route.path);return null==route.children?[{route,fullPath:path}]:route.children.map((route=>this.getEndRoutes(route,path))).flat()}getPathVariableNames(routePath){const pathVariables=routePath.split("/").filter((segment=>segment.startsWith(":")));return pathVariables.map((segment=>segment.slice(1)))}getRouteTree(){return this.router.config.map((route=>this.getEndRoutes(route))).flat().reduce(((acc,route)=>{const routeName=route.route?.data?.name;return null!=routeName&&(acc[routeName]=route),acc}),{})}static{this.ctorParameters=()=>[{type:_angular_router__WEBPACK_IMPORTED_MODULE_2__.Ix}]}};RoutingService=RoutingService_1=(0,tslib__WEBPACK_IMPORTED_MODULE_3__.Cg)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_4__.Injectable)({providedIn:"root"})],RoutingService)},"./src/app/_services/utils/token.service.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>TokenService});var TokenService_1,tslib__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),_angular_common_http__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@angular/common/fesm2022/http.mjs"),_angular_core__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),src_app_models_token__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/app/_models/token.ts"),src_environments_environment__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/environments/environment.ts"),src_utils_logging__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/utils/logging.ts");let TokenService=class TokenService{static{TokenService_1=this}static{this.USER_DATA_KEY="user_data"}constructor(http){this.http=http,this.apiUrl=src_environments_environment__WEBPACK_IMPORTED_MODULE_0__.c.apiUrl,this.jwtTokenUrl=`${this.apiUrl}/token`,this.refreshTokenUrl=`${this.apiUrl}/token/refresh`,this.ID_IDENTIFIER_PREFIX="id_"}login(loginData){return this.http.post(this.jwtTokenUrl,loginData)}logout(){}refreshUserData(){(0,src_utils_logging__WEBPACK_IMPORTED_MODULE_1__.R)(this.refreshUserData.name);const refreshToken=TokenService_1.getRefreshToken()?.token;if(!refreshToken)return;const httpHeaders=(new _angular_common_http__WEBPACK_IMPORTED_MODULE_2__.Lr).set("Authorization",`Bearer ${refreshToken}`);return this.http.post(this.refreshTokenUrl,{refresh:refreshToken},{headers:httpHeaders})}invalidateJWTToken(){}static getUserData(){const rawUserData=localStorage.getItem(TokenService_1.USER_DATA_KEY);return null!=rawUserData&&"undefined"!==rawUserData?JSON.parse(rawUserData):void 0}static getAccessToken(){return this.getUserData()?.accessToken}static getRefreshToken(){return this.getUserData()?.refreshToken}setUserData(data){localStorage.setItem(TokenService_1.USER_DATA_KEY,JSON.stringify(data))}getCampaignRole(data,campaignName){if(null==campaignName)return;const memberships=this.getCampaignMemberships(data);if(null==memberships)return;const role=memberships[campaignName.toLowerCase()];return src_app_models_token__WEBPACK_IMPORTED_MODULE_3__.u.some((roleName=>roleName===role))?role:void 0}getCampaignMemberships(data){if(null==data)return;const campaignMemberships={};for(const campaignIdentifier of Object.keys(data.campaignMemberships)){campaignIdentifier.startsWith(this.ID_IDENTIFIER_PREFIX)||(campaignMemberships[campaignIdentifier.toLowerCase()]=data.campaignMemberships[campaignIdentifier])}return campaignMemberships}isAccessTokenExpired(){return this.isTokenExpired(TokenService_1.getAccessToken())}isRefreshTokenExpired(){return this.isTokenExpired(TokenService_1.getRefreshToken())}isTokenExpired(token){if(null==token)return!0;const expiryTimestamp=token.exp,currentTimestamp=Math.floor((new Date).getTime()/1e3),isExpired=currentTimestamp>=expiryTimestamp;if(isExpired){const currentDate=new Date(1e3*currentTimestamp).toString(),expiryDate=new Date(1e3*expiryTimestamp).toString(),tokenName=token.type.toLocaleUpperCase();console.log(`\n        ${tokenName} Token is expired. \n        Request timestamp: ${currentDate}. \n        Token expiry timestamp: ${expiryDate}\n      `)}return isExpired}static{this.ctorParameters=()=>[{type:_angular_common_http__WEBPACK_IMPORTED_MODULE_2__.Qq}]}};TokenService=TokenService_1=(0,tslib__WEBPACK_IMPORTED_MODULE_4__.Cg)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_5__.Injectable)({providedIn:"root"})],TokenService)},"./src/app/global.store.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{v:()=>GlobalStore});var core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),rxjs_interop=__webpack_require__("./node_modules/@angular/core/fesm2022/rxjs-interop.mjs"),ngrx_operators=__webpack_require__("./node_modules/@ngrx/operators/fesm2022/ngrx-operators.mjs"),ngrx_signals=__webpack_require__("./node_modules/@ngrx/signals/fesm2022/ngrx-signals.mjs"),Observable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),take=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/take.js"),shareReplay=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/shareReplay.js"),routing_service=__webpack_require__("./src/app/_services/routing.service.ts"),tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),http=__webpack_require__("./node_modules/@angular/common/fesm2022/http.mjs");function convertSingleFileModelToFormData(model,fileAttributeName="file"){if(!model.hasOwnProperty(fileAttributeName))throw`Can't convert object to FormData! Your model does not have a ${fileAttributeName} property!`;const formData=new FormData;for(var key in model)if(key===fileAttributeName){switch(model[fileAttributeName].constructor.name){case"FileList":formData.append(key,model[fileAttributeName][0]);break;case"File":formData.append(key,model[fileAttributeName])}}else model[key]&&formData.append(key,model[key]);return formData}var base_service=__webpack_require__("./src/app/_services/base.service.ts");let CampaignService=class CampaignService extends base_service.d{constructor(http){super(http,"campaign")}campaignOverview(){return this.http.get(`${this.baseUrl}/overview/`).pipe((0,shareReplay.t)(1))}create(data){const campaignData=this.processCampaignData(data);return super.create(campaignData)}update(pk,data){const campaignData=this.processCampaignData(data);return super.update(pk,campaignData)}patch(pk,data){const campaignData=this.processCampaignData(data);return super.patch(pk,campaignData)}processCampaignData(userModel){const hasNewIcon=this.hasImageSelected(userModel.icon),hasNewBackgroundImage=this.hasImageSelected(userModel.background_image);if(hasNewIcon||hasNewBackgroundImage){if(!hasNewIcon&&hasNewBackgroundImage){delete userModel.icon;return convertSingleFileModelToFormData(userModel,"background_image")}if(hasNewIcon&&!hasNewBackgroundImage){delete userModel.background_image;return convertSingleFileModelToFormData(userModel,"icon")}return function convertMultiFileModelToFormData(model,fileAttributeNames){fileAttributeNames.forEach((name=>{if(!model.hasOwnProperty(name))throw`Can't convert object to FormData! Your model does not have a ${name} property!`}));const formData=new FormData;for(var key in model)fileAttributeNames.includes(key)?formData.append(key,model[key][0]):model[key]&&formData.append(key,model[key]);return formData}(userModel,["background_image","icon"])}{delete userModel.icon,delete userModel.background_image;const formData=new FormData;return Object.keys(userModel).forEach((key=>formData.append(key,userModel[key]))),formData}}hasImageSelected(imageFieldValue){return"FileList"===imageFieldValue.constructor.name||"File"===imageFieldValue.constructor.name}delete(pk){throw"You can not delete a campaign, please use 'deactivate' instead"}deactivate(pk){return super.delete(pk)}statistics(campaign_name){const statisticsUrl=`${this.apiUrl}/admin/statistics/${campaign_name}`;return this.http.get(statisticsUrl)}readByParam(campaign){return this.http.get(`${this.baseUrl}/${campaign}/`)}addGuest(campaign,user){const requestBody={action:"add_guest",user};return this.http.patch(`${this.baseUrl}/${campaign}/members/`,requestBody)}addMember(campaign,user){const requestBody={action:"add_member",user};return this.http.patch(`${this.baseUrl}/${campaign}/members/`,requestBody)}addAdmin(campaign,user){const requestBody={action:"add_admin",user};return this.http.patch(`${this.baseUrl}/${campaign}/members/`,requestBody)}removeGuest(campaign,user){const requestBody={action:"remove_guest",user};return this.http.patch(`${this.baseUrl}/${campaign}/members/`,requestBody)}removeMember(campaign,user){const requestBody={action:"remove_member",user};return this.http.patch(`${this.baseUrl}/${campaign}/members/`,requestBody)}removeAdmin(campaign,user){const requestBody={action:"remove_admin",user};return this.http.patch(`${this.baseUrl}/${campaign}/members/`,requestBody)}addEmptySearchResponse(responseModel){const emptySearchUrl=`${this.apiUrl}/emptysearchresponse/`;return this.http.post(emptySearchUrl,responseModel)}deleteEmptySearchResponse(emptySearchResponsePk){return this.http.delete(`${this.apiUrl}/emptysearchresponse/pk/${emptySearchResponsePk}/`)}parseEntity(data){return data}parseOverviewEntity(data){return data}static{this.ctorParameters=()=>[{type:http.Qq}]}};CampaignService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"})],CampaignService);var asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),ReplaySubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/ReplaySubject.js"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),skip=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/skip.js"),rxjs_operators=__webpack_require__("./src/utils/rxjs-operators.ts");let GlobalUrlParamsService=class GlobalUrlParamsService{constructor(campaignService,urlLocation){this.campaignService=campaignService,this.urlLocation=urlLocation,this.campaignSetTrigger$=new Subject.B,this.currentRouteSnapshot$=new ReplaySubject.m(1),this.campaignNameParam$=this.currentRouteSnapshot$.pipe((0,map.T)((snapshot=>snapshot?.params.campaign)),(0,rxjs_operators.cY)("campaignName")),this.currentRouteSnapshot$.subscribe()}refreshAndReturnToLastURL(){var _this=this;return(0,asyncToGenerator.A)((function*(){_this.campaignService.campaignOverview().pipe((0,skip.i)(1),(0,take.s)(1)).subscribe((()=>_this.urlLocation.back()))}))()}nextSnapshot(snapshot){this.currentRouteSnapshot$.next(snapshot)}static{this.ctorParameters=()=>[{type:CampaignService},{type:common.Location}]}};GlobalUrlParamsService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"})],GlobalUrlParamsService);var token_service=__webpack_require__("./src/app/_services/utils/token.service.ts");const initialAuthState={contentScrollEvents:void 0,userData:void 0,currentCampaign:void 0,campaigns:void 0},GlobalStore=(0,ngrx_signals.Eu)((0,ngrx_signals.Q2)(initialAuthState),(0,ngrx_signals.QO)((state=>{const tokenService=(0,core.inject)(token_service.B),screenSize$=new Observable.c((observer=>{const resizeObserver=new ResizeObserver((entries=>{for(const entry of entries)observer.next({width:entry.contentRect.width,height:entry.contentRect.height})}));return resizeObserver.observe(document.body),()=>resizeObserver.disconnect()}));return{screenSize:(0,rxjs_interop.ot)(screenSize$),campaignName:(0,core.computed)((()=>state.currentCampaign()?.name)),currentCampaignRole:(0,core.computed)((()=>{const currentCampaign=state.currentCampaign(),userData=state.userData();if(null!=currentCampaign&&null!=userData)return tokenService.getCampaignRole(userData,currentCampaign.name)})),isGlobalAdmin:(0,core.computed)((()=>state.userData()?.isAdmin||state.userData()?.isSuperUser)),currentUserName:(0,core.computed)((()=>state.userData()?.userName)),currentUserPk:(0,core.computed)((()=>state.userData()?.userId)),refreshToken:(0,core.computed)((()=>state.userData()?.refreshToken)),accessToken:(0,core.computed)((()=>state.userData()?.accessToken)),hasTokens:(0,core.computed)((()=>!!state.userData()?.accessToken&&!!state.userData()?.refreshToken)),hasValidJWTToken:(0,core.computed)((()=>{const accessToken=state.userData()?.accessToken,refreshToken=state.userData()?.refreshToken;return!(!accessToken||!refreshToken)&&!function isTokenExpired(token){if(null==token)return!0;const expiryTimestamp=token.exp,currentTimestamp=Math.floor((new Date).getTime()/1e3),isExpired=currentTimestamp>=expiryTimestamp;if(isExpired){const currentDate=new Date(1e3*currentTimestamp).toString(),expiryDate=new Date(1e3*expiryTimestamp).toString(),tokenName=token.type.toLocaleUpperCase();console.log(`\n      ${tokenName} Token is expired. \n      Request timestamp: ${currentDate}. \n      Token expiry timestamp: ${expiryDate}\n    `)}return isExpired}(refreshToken)}))}})),(0,ngrx_signals.RI)((state=>{const tokenService=(0,core.inject)(token_service.B),campaignService=(0,core.inject)(CampaignService);return{getCampaignRole:campaignName=>{const userData=state.userData();if(null!=userData)return tokenService.getCampaignRole(userData,campaignName)},login:loginData=>tokenService.login(loginData).pipe((0,take.s)(1),(0,ngrx_operators.Hn)({next:userData=>(0,ngrx_signals.M8)(state,{userData}),error:err=>console.error(err)})),refreshUserData:()=>{const refresh$=tokenService.refreshUserData().pipe((0,take.s)(1),(0,shareReplay.t)(1));return refresh$.subscribe((userData=>(0,ngrx_signals.M8)(state,{userData}))),refresh$},logout:()=>{tokenService.logout(),(0,ngrx_signals.M8)(state,{userData:void 0,campaigns:void 0,currentCampaign:void 0,contentScrollEvents:void 0})},isCampaignMember:campaignName=>{campaignName=campaignName??state.campaignName();const userData=state.userData();if(null==userData)return!1;const role=tokenService.getCampaignRole(userData,campaignName);return state.isGlobalAdmin()||"guest"===role},isCampaignAdmin:campaignName=>{campaignName=campaignName??state.campaignName();const userData=state.userData();if(null==userData)return!1;const role=tokenService.getCampaignRole(userData,campaignName);return state.isGlobalAdmin()||"admin"===role},isCampaignGuest:campaignName=>{campaignName=campaignName??state.campaignName();const userData=state.userData();if(null==userData)return!1;const role=tokenService.getCampaignRole(userData,campaignName);return state.isGlobalAdmin()||"guest"===role},loadCampaignOverview:()=>{campaignService.campaignOverview().pipe((0,take.s)(1)).subscribe((campaigns=>(0,ngrx_signals.M8)(state,{campaigns})))},hasRoleOrBetter:minimumRole=>(0,core.computed)((()=>{const currentRole=state.currentCampaignRole();return null!=currentRole&&function hasRoleOrBetter(role,minimumRole){switch(minimumRole){case"member":return["member","admin"].includes(role);case"admin":return"admin"===role;case"guest":return["member","admin","guest"].includes(role);default:return!1}}(currentRole,minimumRole)})),fireScrollEvent:event=>{(0,ngrx_signals.M8)(state,{contentScrollEvents:event})}}})),(0,ngrx_signals.TK)((store=>{const tokenService=(0,core.inject)(token_service.B),routingService=(0,core.inject)(routing_service.O),paramsService=(0,core.inject)(GlobalUrlParamsService);return{onInit:()=>{const localUserData=token_service.B.getUserData();(0,ngrx_signals.M8)(store,{userData:localUserData}),(0,core.effect)((()=>tokenService.setUserData(store.userData()))),(0,core.effect)((()=>{null==store.userData()&&routingService.routeToPath("login")})),(0,core.effect)((()=>{const{accessToken,refreshToken}=store.userData()??{};console.groupCollapsed("token expiration check"),tokenService.isTokenExpired(accessToken),tokenService.isTokenExpired(refreshToken),console.groupEnd()}));const campaignParam$=paramsService.campaignNameParam$.pipe((0,rxjs_interop.pQ)()),campaignParam=(0,rxjs_interop.ot)(campaignParam$);(0,core.effect)((()=>{const campaigns=store.campaigns(),currentCampaignName=campaignParam(),currentCampaign=campaigns?.find((campaign=>campaign.name===currentCampaignName));(0,ngrx_signals.M8)(store,{campaigns,currentCampaign})}),{allowSignalWrites:!0})}}})))},"./src/utils/object.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ui:()=>getCorrectKey,p:()=>getNestedProperty});var _string__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/utils/string.ts");function getCorrectKey(obj,key){if(key in obj)return key;const snakeCaseKey=(0,_string__WEBPACK_IMPORTED_MODULE_0__.C8)(key);if(snakeCaseKey in obj)return snakeCaseKey;const camelCaseKey=(0,_string__WEBPACK_IMPORTED_MODULE_0__.sF)(key);return camelCaseKey in obj?camelCaseKey:void 0}function getNestedProperty(item,keyPath){const keys=keyPath.split(".");let currentValue=item;for(let key of keys){if(!(key in currentValue)){throw new Error(`Cannot find nested property '${keyPath}' in '${JSON.stringify(item)}'`)}currentValue=currentValue[key]}return currentValue}}}]);