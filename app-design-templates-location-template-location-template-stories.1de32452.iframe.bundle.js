(self.webpackChunknimstoryfont_gui=self.webpackChunknimstoryfont_gui||[]).push([[4679],{"./src/app/design/templates/location-template/location-template.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,NoPermission:()=>NoPermission,default:()=>location_template_stories});var testing=__webpack_require__("./node_modules/@angular/router/fesm2020/testing.mjs"),ngx_formly_core=__webpack_require__("./node_modules/@ngx-formly/core/fesm2020/ngx-formly-core.mjs"),dist=__webpack_require__("./node_modules/@storybook/addon-actions/dist/index.mjs"),angular_dist=__webpack_require__("./node_modules/@storybook/angular/dist/index.mjs"),validators=__webpack_require__("./src/app/_services/formly/validators.ts"),molecules=__webpack_require__("./src/app/design/molecules/index.ts"),organisms=__webpack_require__("./src/app/design/organisms/index.ts"),tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.js");var _class,location_template_componentngResource=__webpack_require__("./src/app/design/templates/location-template/location-template.component.scss?ngResource"),location_template_componentngResource_default=__webpack_require__.n(location_template_componentngResource),core=__webpack_require__("./node_modules/@angular/core/fesm2020/core.mjs"),routing_service=__webpack_require__("./src/app/_services/routing.service.ts");let LocationTemplateComponent=((_class=class LocationTemplateComponent{constructor(routingService){this.routingService=routingService,this.canUpdate=!1,this.canCreate=!1,this.canDelete=!1,this.createImage=new core.EventEmitter,this.deleteImage=new core.EventEmitter,this.updateImage=new core.EventEmitter,this.locationDelete=new core.EventEmitter}ngOnInit(){const campaignName=this.location.campaign_details?.name;this.overviewUrl=this.routingService.getRoutePath("location-overview",{campaign:campaignName}),this.markerCreateUrl=this.routingService.getRoutePath("marker-create",{parent_location_name:this.location.parent_location_details?.name,location_name:this.location.name,campaign:campaignName}),this.setParentLocations(),this.setLocationCharacters(),this.setMarkerEntries(),this.setUrls()}ngOnChanges(){this.setParentLocations(),this.setLocationCharacters(),this.setMarkerEntries(),this.setUrls()}routeToCharacterCreation(){const campaignName=this.location.campaign_details?.name;this.routingService.routeToPath("character-create",{campaign:campaignName})}setUrls(){const campaignName=this.location.campaign_details?.name;this.updateUrl=this.routingService.getRoutePath("location-update",{name:this.location.name,parent_name:this.location.parent_location,campaign:campaignName})}setLocationCharacters(){const campaignName=this.location.campaign_details?.name;this.locationCharacters=this.location.characters?.map((character=>({label:character.name,link:this.routingService.getRoutePath("character",{campaign:campaignName,name:character.name})})))??[]}setMarkerEntries(){const campaignName=this.location.campaign_details?.name;this.markerEntries=this.location.marker_details?.map((marker=>({text:marker.map,link:this.routingService.getRoutePath("marker",{parent_location_name:this.location.parent_location_details?.name??"None",location_name:this.location.name,map_name:marker.map,campaign:campaignName}),badgeValue:marker.map})))??[]}setParentLocations(){const parentNames=this.location.parent_location_list;this.parentLocations=parentNames?.map((parent=>({label:parent,link:this.buildLocationUrl(parent,parentNames)})))??[]}buildLocationUrl(locationName,locationList){if(!locationList)throw"Tried building a route to a location in parent_location_list when there is no parent_location_list";const index=locationList.indexOf(locationName),parentLocationName=0===index?"None":locationList[index-1],campaignName=this.location.campaign_details?.name;return this.routingService.getRoutePath("location",{parent_name:parentLocationName,name:locationName,campaign:campaignName})}}).ctorParameters=()=>[{type:routing_service.Z}],_class.propDecorators={location:[{type:core.Input}],serverUrl:[{type:core.Input}],imageServerModel:[{type:core.Input}],canUpdate:[{type:core.Input}],canCreate:[{type:core.Input}],canDelete:[{type:core.Input}],createImage:[{type:core.Output}],deleteImage:[{type:core.Output}],updateImage:[{type:core.Output}],locationDelete:[{type:core.Output}]},_class);LocationTemplateComponent=(0,tslib_es6.gn)([(0,core.Component)({selector:"app-location-template",template:'<div class="main" #article>\n  <article class="container">\n    <ng-container *ngIf="canUpdate">\n      <div class="location__edit-container">\n        <a [routerLink]="updateUrl">\n          <app-button\n            [icon]="\'pencil\'"\n            [type]="\'SECONDARY\'"\n          ></app-button>\n        </a>\n      </div>\n    </ng-container>\n\n    \x3c!-- Heading --\x3e\n    <div class="row">\n      <h1 class="col-12 location__heading"> \n        {{ location.name }} \n      </h1>\n\n      \x3c!-- String indicating all parent_locations --\x3e\n      <ng-container *ngIf="location.parent_location_list?.length ?? 0 > 0">\n        <h5 class="col-12 location__subheading subheading">\n          <ng-container *ngFor="let parentLocation of parentLocations; let i = index">\n            <a [routerLink]="parentLocation.link">\n              {{ parentLocation.label }}\n            </a>\n            <app-icon\n              class="subheading__icon"\n              [icon]="\'arrow-right\'"\n            ></app-icon>\n          </ng-container>\n          {{ location.name }}\n        </h5>\n      </ng-container>\n\n    </div>\n\n  \x3c!-- Image Gallery --\x3e\n  <div class="location__images">\n    \x3c!-- Image Gallery --\x3e\n    <app-image-carousel-card\n      [images]="location.images ?? []"\n      [serverUrl]="serverUrl"\n      [serverModel]="imageServerModel"\n      [canUpdate]="canUpdate"\n      [canCreate]="canCreate"\n      [canDelete]="canDelete"\n      (createImage)="createImage.emit($event)"\n      (deleteImage)="deleteImage.emit($event)"\n      (updateImage)="updateImage.emit($event)"\n    ></app-image-carousel-card>\n  </div>\n\n    <div class="mb-3">\n      <app-badge-list\n        [entries]="markerEntries"\n        [canCreate]="canCreate"\n        [canDelete]="false"\n        [label]="\'Mapmarker\'"\n        [createOptions]="markerCreateUrl"\n      ></app-badge-list>\n    </div>\n\n    \x3c!-- Description --\x3e\n    <div class="location__description">\n      <h4> Description </h4>\n      <app-html-text\n        [text]="location.description"\n      ></app-html-text>\n    </div>\n\n    \x3c!-- Characters of Interest --\x3e\n    <div class="location__characters">\n      <app-list\n        [heading]="\'Characters of interest\'"\n        [entries]="locationCharacters"\n        [enableCreate]="canCreate"\n        [emptyListText]="\'You know nobody in \' + location.name"\n        (create)="routeToCharacterCreation()"\n      ></app-list>\n    </div>\n\n\n    \x3c!-- Locations of Interest --\x3e\n    <div class="encounter-list mb-5 mt-3">\n      <app-location-accordion \n        [locations]="location.sublocations ?? []"\n        [canCreate]="canCreate"\n      ></app-location-accordion>\n    </div>\n\n    \x3c!-- Footer (Move to other Article + Delete Article) --\x3e\n    <app-article-footer\n      [buttonLink]="overviewUrl"\n      [buttonLabel]="\'Back to Creatures\'"\n      [showDelete]="canDelete"\n      [deleteMessage]="\'Delete \' + location.name + \'?\'"\n      (delete)="locationDelete.emit(location)"\n    ></app-article-footer>\n    \n  </article>\n</div>\n',styles:[location_template_componentngResource_default()]})],LocationTemplateComponent);const dummyLocation={getAbsoluteRouterUrl:()=>"location/2",name_full:"Central Park",name:"Central Park",description:"A large public park in New York City.",parent_location:456,images:[{pk:1,image:"/breeds/mastiff-tibetan/n02108551_5830.jpg",name:"Goblin portrait",creature_article:123},{pk:2,image:"/breeds/germanshepherd/IMG_20200801_005830_387.jpg",name:"Goblin horde",creature_article:123}],parent_location_details:{pk:456,name:"New York City",parent_location:"United States",name_full:"New York City, United States"},parent_location_list:["United States","New York City"],characters:[{name:"John Smith",pk:789,name_full:"John Smith"},{name:"Jane Doe",pk:987,name_full:"Jane Doe"}],sublocations:[{creation_datetime:"2022-05-06T09:30:00.000Z",update_datetime:"2022-05-06T10:15:00.000Z",name:"The Pond",pk:124,characters:[{name:"Bob Johnson",pk:456,name_full:"Bob Johnson"},{name:"Alice Williams",pk:654,name_full:"Alice Williams"}],name_full:"The Pond, Central Park",description:"A small body of water in Central Park.",getAbsoluteRouterUrl:()=>"/location/1"}],marker_details:[{map:"map1",map_icon:"icon1"},{map:"map2",map_icon:"icon2"}],getAbsoluteRouterUrlForParentLocation(){return`https://example.com/locations/${this.parent_location}`}},location_template_stories={title:"DesignSystem/Templates/LocationTemplateComponent",component:LocationTemplateComponent,decorators:[(0,angular_dist.moduleMetadata)({imports:[organisms.kJ,testing.Z_,ngx_formly_core.X0.forRoot({types:[{name:"file",component:molecules.nE,wrappers:["form-field"]}],validationMessages:[validators.Bw,validators.l$],validators:[validators.np,validators.x5]})],declarations:[]})],args:{imageServerModel:void 0,canCreate:!0,canUpdate:!0,canDelete:!0,location:dummyLocation,serverUrl:"https://images.dog.ceo"}},Template=args=>({props:{...args,createImage:(0,dist.aD)("createImage"),deleteImage:(0,dist.aD)("deleteImage"),updateImage:(0,dist.aD)("updateImage"),locationDelete:(0,dist.aD)("locationDelete")}}),Default=Template.bind({});Default.args={};const NoPermission=Template.bind({});NoPermission.args={canDelete:!1,canUpdate:!1,canCreate:!1}},"./src/app/_services/formly/validators.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Be:()=>requiredIconMessage,Bo:()=>fieldsDontMatchMessage,Bw:()=>requiredMessage,Ds:()=>hasSpecialCharactersMessage,K7:()=>requiredIconValidator,Kg:()=>sessionAuthorUniqueValidator,U3:()=>iconValidator,UP:()=>invalidTimeMessage,YM:()=>timeValidator,_7:()=>fieldMatchValidator,cc:()=>specialCharacterValidator,eS:()=>sessionAlreadyHasAuthor,l$:()=>notIntegerMessage,np:()=>requiredValidator,ol:()=>dateMessage,sm:()=>dateValidator,ud:()=>faPrefixMessage,x5:()=>integerValidator});var _home_runner_work_nimstoryfont_gui_nimstoryfont_gui_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js");const invalidTimeMessage={name:"time",message:"Time must have 'hh:mm:ss' pattern"},requiredMessage={name:"required",message:"This field is required!"},dateMessage={name:"date",message:"This date does not follow the pattern: 'YYYY-MM-DD'. Sorry to be such a Nazi about it. The computer is forcing me."},requiredIconMessage={name:"requiredIcon",message:"This field requires a fontawesome icon as input. Here is a list of them: https://fontawesome.com/v4.7.0/icons/"},faPrefixMessage={name:"faPrefix",message:"Icons are stored without the 'fa-' from font-awesome prefix"},notIntegerMessage={name:"notInteger",message:"Your input is not an integer. This field requires an integer number. No amount of revolution can overcome this."},hasSpecialCharactersMessage={name:"hasSpecialCharacters",message:'Your input includes one of the following invalid special characters: [ ] ( ) ? | \\ " % ~ # < > :. If you need to rebel, please dont against this.'},fieldsDontMatchMessage={name:"fieldMatch",message:"Password Not Matching"},sessionAlreadyHasAuthor={name:"isInvalidSessionAuthorPair",message:"\n    The author you selected already has a diaryentry in the session you selected. You \n    can't have 2 diaryentries from the same author in the same session. Consider writing \n    your diaryentry as an encounter instead into the diaryentry at the spot you just considered."};const timeValidator={name:"time",validation:function timeValidation(control){const isValidTime=/\d\d.[0-5]\d.[0-5]\d/.test(control.value);return isValidTime?null:{time:!isValidTime}}};function requiredValidation(control){return!!control.value||0===control.value?null:{required:!0}}const requiredValidator={name:"required",validation:requiredValidation},requiredIconValidator={name:"requiredIcon",validation:requiredValidation};const dateValidator={name:"date",validation:function dateValidation(control){return/[1-2]\d{3}-(0\d|1[0-2])-[0-3]\d/.test(control.value)?null:{date:!0}}};const iconValidator={name:"faPrefix",validation:function iconValidation(control){const hasFaPrefix=/fa-/.test(control.value);return hasFaPrefix?null:{faPrefix:hasFaPrefix}}};const integerValidator={name:"notInteger",validation:function isIntegerValidation(control){const isInteger="number"==typeof control.value&&Number.isInteger(control.value);return isInteger?null:{notInteger:!isInteger}}};const specialCharacterValidator={name:"hasSpecialCharacters",validation:function hasNoSpecialCharactersValidation(control){if("string"==typeof control.value){const specialCharacters=["[","]","(",")","|","\\",'"',"%","~","#","<",">","?","/",":"];for(const specialCharacter of specialCharacters)if(control.value.includes(specialCharacter))return{hasSpecialCharacters:!0}}return null}};const fieldMatchValidator={name:"fieldMatch",validation:function passwordMatchValidation(control){const{password,passwordConfirm}=control.value;return passwordConfirm&&password?passwordConfirm===password?{passwordMatch:!0}:null:{passwordMatch:!0}}};function _isSessionAuthorPairUniqueValidator(){return(_isSessionAuthorPairUniqueValidator=(0,_home_runner_work_nimstoryfont_gui_nimstoryfont_gui_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(control){const{session:selectedSessionId,author:selectedAuthorId}=control.value,selectFieldOptionsObs=control.controls.session._fields[0].templateOptions.options,selectedOption=(yield selectFieldOptionsObs.toPromise()).find((option=>option.pk===selectedSessionId));if(null==selectedOption)throw"WeirdError. You selected a session, its id got into the model and somehow that field is no longer among the options (?)";const selectedAuthorAlreadyHasDiaryentryOnSession=selectedOption.author_ids.includes(selectedAuthorId),isInitialValue=control.pristine;return selectedAuthorAlreadyHasDiaryentryOnSession&&!isInitialValue?{passwordMatch:{message:"That account already has a diaryentry written for that session. Accounts can only have one Diaryentry per session"}}:{passwordMatch:null}}))).apply(this,arguments)}const sessionAuthorUniqueValidator={name:"sessionAuthorPairUnique",validation:function isSessionAuthorPairUniqueValidator(_x){return _isSessionAuthorPairUniqueValidator.apply(this,arguments)}}},"./node_modules/@storybook/addon-actions/dist/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{aD:()=>chunk_KKE3V3AL.aD});var chunk_KKE3V3AL=__webpack_require__("./node_modules/@storybook/addon-actions/dist/chunk-KKE3V3AL.mjs");__webpack_require__("./node_modules/@storybook/addon-actions/dist/chunk-VWCVBQ22.mjs")},"./src/app/design/templates/location-template/location-template.component.scss?ngResource":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_EXPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.push([module.id,".location__edit-container {\n  width: 100%;\n  display: flex;\n  justify-content: end;\n}\n.location__heading {\n  text-align: center;\n}\n.location__subheading {\n  margin-bottom: var(--spacer-3);\n  text-align: center;\n}\n.location__characters {\n  margin-bottom: var(--spacer-5);\n}\n.location__images {\n  margin-bottom: var(--spacer-3);\n}\n.location__description {\n  margin-bottom: var(--spacer-5);\n}\n\n.subheading__icon {\n  margin-left: var(--spacer-1);\n  margin-right: var(--spacer-1);\n}",""]),module.exports=___CSS_LOADER_EXPORT___.toString()}}]);