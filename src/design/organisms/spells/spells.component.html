<div class="container list">
  @if (canCreate) {
    <div class="row list__button">
      <app-button
        class="list__button--button"
        [type]="'PRIMARY'"
        [text]="'Add Spell'"
        [icon]="'plus'"
        (click)="addSpell()"
      ></app-button>
    </div>
  }

  <div class="row">
    @for (card of spellCards; track card.spell.pk) {
      <div class="list__spell-card spell-card">
        <app-collapsible-panel
          [isOpen]="card.isOpen"
          [ngClass]="{
            'animate__animated animate__zoomIn': card.spell.pk == null,
          }"
        >
          <div heading class="spell-card__heading">
            <span>
              {{ card.spell.name ?? "" }}
            </span>

            <span>
              @for (
                connection of card.spell.player_class_connections;
                track connection.pk
              ) {
                <button
                  class="spell-card__class"
                  (click)="onSpellClassClick($event, connection)"
                >
                  <app-badge
                    [text]="connection.player_class_details?.name ?? ''"
                    [type]="'DARK'"
                  ></app-badge>
                </button>
              }
            </span>
          </div>
          <app-spell
            body
            class="spell-card__spell"
            [spell]="card.spell"
            [serverModel]="serverModel"
            [playerClasses]="playerClasses"
            [canUpdate]="canUpdate"
            [canDelete]="canDelete"
            [canCreate]="canCreate"
            [cancelButtonType]="'DARK'"
            (spellDelete)="onSpellDelete($event, $index)"
            (spellCreate)="spellCreate.emit($event)"
            (spellUpdate)="spellUpdate.emit($event)"
            (spellCreateCancel)="removeSpell($index)"
            (connectionDelete)="connectionDelete.emit($event)"
            (connectionCreate)="connectionCreate.emit($event)"
          ></app-spell>
        </app-collapsible-panel>
      </div>
    }
  </div>
</div>

<!-- Loading Spinner -->
<ng-template #loading><app-spinner></app-spinner></ng-template>
