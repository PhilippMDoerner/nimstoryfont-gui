<div class="container">
  <form
    class="row filter"
    autocomplete="off"
    (submit)="openFirstArticle($event)"
    [hotkey]="'f'"
    (hotkeyPressed)="filterInputElement.focus()"
    role="search"
  >
    <label class="fs-5 fw-bold p-0" [for]="searchId">
      Search for article
    </label>
    <div class="filter__input-container">
      <input
        [id]="searchId"
        class="filter__input"
        type="text"
        #filterInputElement
        [attr.aria-controls]="listId"
        (keyDown)="filterValue.set(filterInputElement.value)"
        (input)="filterValue.set(filterInputElement.value)"
      />
      <button
        btn
        class="filter__button"
        [kind]="'SECONDARY'"
        [icon]="'search'"
        [type]="'submit'"
        aria-label="Start search"
      ></button>
    </div>
  </form>

  <section>
    @switch (mode()) {
      @case ("LETTER") {
        <ng-container *ngTemplateOutlet="letterList" />
      }
      @case ("PROPERTY") {
        <ng-container *ngTemplateOutlet="propertyList" />
      }
      @case ("SEARCH") {
        <ng-container *ngTemplateOutlet="searchList" />
      }
    }
  </section>
</div>

<ng-template #letterList>
  <ul
    [id]="listId"
    class="row"
    [attr.aria-label]="
      'All recorded ' + heading() + ', split into lists by first letter'
    "
  >
    @for (
      itemLetterEntries of displayEntries() | groupByFirstLetter: labelProp();
      track $index
    ) {
      <li
        class="letter-list"
        [ngClass]="{
          'col-sm-6 col-lg-4': !filterInputElement.value && !forceSingleLine(),
          'col-12': filterInputElement.value || forceSingleLine(),
        }"
      >
        <!-- Letter Heading -->
        @if (filterInputElement.value.length === 0) {
          <div class="fs-5 letter-list__heading" aria-hidden="true">
            {{ itemLetterEntries.key }}
          </div>
        }

        <!-- Article List -->
        <ul
          class="letter-list__list"
          [attr.aria-label]="
            heading() + ' names starting with \'' + itemLetterEntries.key + '\''
          "
        >
          @for (item of itemLetterEntries.value; track $index) {
            <li class="letter-list__item">
              <a [routerLink]="item.link">
                {{ item[labelProp()] }}
              </a>
            </li>
          }
        </ul>
      </li>
    }
  </ul>
</ng-template>

<ng-template #propertyList>
  @let groupPropVal = groupProp();

  <ul
    class="row"
    [id]="listId"
    [attr.aria-label]="
      'All recorded ' +
      heading() +
      ', split into lists based on ' +
      groupPropVal
    "
  >
    @if (groupPropVal) {
      @for (
        itemLetterEntries of displayEntries()
          | groupBy: groupPropVal : "session_details.session_number";
        track $index
      ) {
        <li
          class="letter-list"
          [ngClass]="{
            'col-sm-6 col-lg-4': !filterInputElement.value && !forceSingleLine,
            'col-12': filterInputElement.value || forceSingleLine,
          }"
        >
          <!-- Letter Heading -->
          @if (filterInputElement.value.length === 0) {
            <h5 class="letter-list__heading">
              {{ itemLetterEntries.key }}
            </h5>
          }

          <!-- Article List -->
          <ul class="letter-list__list">
            @for (item of itemLetterEntries.value; track $index) {
              <li class="letter-list__item">
                <a [routerLink]="item.link">
                  {{ item[labelProp()] }}
                </a>
              </li>
            }
          </ul>
        </li>
      }
    }
  </ul>
</ng-template>

<ng-template #searchList>
  <ul
    class="row"
    [id]="listId"
    [attr.aria-label]="
      'All entries matching search query \'' + filterInputElement.value + '\''
    "
  >
    @for (entry of displayEntries(); track entry[labelProp()]) {
      <li class="letter-list__item col-12">
        <a [routerLink]="entry.link">
          {{ entry[labelProp()] }}
        </a>
      </li>
    }
  </ul>
</ng-template>
