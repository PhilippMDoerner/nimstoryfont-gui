<article class="container create-update">
  <h1 class="create-update__heading heading">
    
    <span class="heading__text">
      {{ state === 'CREATE' ? 'Create new Character' : 'Update Character' }}
    </span>  
    
    <!-- Heading -->
    <div class="heading__edit-cancel">
      <app-button
        (click)="onCancel()"
        [icon]="'times'"
        [type]="'SECONDARY'"
      ></app-button>
    </div>
  </h1>

  <!-- Form -->
  <ng-container [ngSwitch]="state">
    <ng-container 
      *ngSwitchCase="'CREATE'"
      [ngTemplateOutlet]="createForm"
    ></ng-container>
    <ng-container 
      *ngSwitchCase="'UPDATE'"
      [ngTemplateOutlet]="updateForm"
    ></ng-container>
    <ng-container 
      *ngSwitchCase="'OUTDATED_UPDATE'"
      [ngTemplateOutlet]="outdatedUpdateForm"
    ></ng-container>
  </ng-container>
  
</article>

<ng-template #createForm>
  <app-form
    class="create-update__form"
    [model]="userModel" 
    [fields]="formlyFields" 
    (formlySubmit)="onSubmit($event)" 
    (formlyCancel)="onCancel()"
  ></app-form>
</ng-template>

<ng-template #updateForm>
  <div class="create-update__form form">
        
    <div class="form__player-classes">
      <h3> {{userModel.name}}'s Classes </h3>
      <!-- Add-Class-Badge -->
      <app-badge-list
        [label]="'Class'"
        [entries]="characterClasses"
        [createOptions]="{
          options: classOptions,
          valueProp: 'pk',
          labelProp: 'name',
        }"
        [canCreate]="true"
        [canDelete]="true"
        (entryCreate)="addClass.emit($event)"
        (entryDelete)="removeClass.emit($event)"
      ></app-badge-list>
    </div>    
  
    <!-- Memberships -->
    <div class="form__memberships">    
      <h3> {{userModel.name}}'s Organization Memberships </h3>
      
      <!-- Add-Class-Badge -->
      <app-badge-list
        [label]="'Membership'"
        [entries]="characterOrganizations"
        [createOptions]="{
          options: organizations,
          valueProp: 'pk',
          labelProp: 'name',
        }"
        [canCreate]="true"
        [canDelete]="true"
        (entryCreate)="addOrganizationMembership.emit($event)"
        (entryDelete)="removeOrganizationMembership.emit($event)"
      ></app-badge-list>
    </div>
    
    <app-separator></app-separator>

    <div class="form__character-data">
      <h3> Character Data </h3>
      <app-form
        [model]="userModel" 
        [fields]="formlyFields" 
        (formlySubmit)="onSubmit($event)" 
        (formlyCancel)="onCancel()"
      ></app-form>
    </div>
    
  </div>
  
</ng-template>

<ng-template #outdatedUpdateForm>
  <app-compare-form
    [fields]="formlyFields"
    [modelFromUser]="userModel"
    [modelFromServer]="serverModel"
    (formlySubmit)="onSubmit($event)"
    (formlyCancel)="onCancel()"
  ></app-compare-form>
</ng-template>