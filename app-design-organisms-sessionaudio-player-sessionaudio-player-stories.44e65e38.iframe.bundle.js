(self.webpackChunknimstoryfont_gui=self.webpackChunknimstoryfont_gui||[]).push([[4565],{"./src/app/design/organisms/sessionaudio-player/sessionaudio-player.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,default:()=>__WEBPACK_DEFAULT_EXPORT__});var _ngx_formly_core__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@ngx-formly/core/fesm2020/ngx-formly-core.mjs"),_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@storybook/addon-actions/dist/index.mjs"),_storybook_angular__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/angular/dist/index.mjs"),src_app_services_formly_validators__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/app/_services/formly/validators.ts"),_molecules__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/app/design/molecules/index.ts"),_player_player_component__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/app/design/organisms/player/player.component.ts");const __WEBPACK_DEFAULT_EXPORT__={title:"DesignSystem/Organisms/SessionaudioPlayerComponent",component:__webpack_require__("./src/app/design/organisms/sessionaudio-player/sessionaudio-player.component.ts").C,decorators:[(0,_storybook_angular__WEBPACK_IMPORTED_MODULE_1__.moduleMetadata)({imports:[_molecules__WEBPACK_IMPORTED_MODULE_3__._V,_ngx_formly_core__WEBPACK_IMPORTED_MODULE_6__.X0.forRoot({validationMessages:[src_app_services_formly_validators__WEBPACK_IMPORTED_MODULE_2__.Bw,src_app_services_formly_validators__WEBPACK_IMPORTED_MODULE_2__.l$,src_app_services_formly_validators__WEBPACK_IMPORTED_MODULE_2__.UP],validators:[src_app_services_formly_validators__WEBPACK_IMPORTED_MODULE_2__.np,src_app_services_formly_validators__WEBPACK_IMPORTED_MODULE_2__.x5,src_app_services_formly_validators__WEBPACK_IMPORTED_MODULE_2__.YM]})],declarations:[_player_player_component__WEBPACK_IMPORTED_MODULE_4__.l]})],args:{audioSource:"/tech/piano2-CoolEdit.mp3",downloadSource:"https://www.potato.testurl.com",canDelete:!0,canCreate:!0,timestamps:[{pk:1,name:"Timestamp 1",time:1.5,encounter:"Encounter 1",session_audio:123},{pk:2,name:"Timestamp 2",time:2.3,encounter:"Encounter 1",session_audio:123},{pk:3,name:"Timestamp 3",time:3.2,encounter:"Encounter 2",session_audio:456},{pk:4,name:"Timestdsfa fasdfdas fsdafsdamp 4",time:4.1,encounter:"Encounter 2",session_audio:456},{pk:5,name:"Timestamp 5",time:4.8,session_audio:789}],serverUrl:"https://www.kozco.com"}},Default=(args=>({props:{...args,deleteTimestamp:(0,_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_0__.aD)("deleteTimestamp"),createTimestamp:(0,_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_0__.aD)("createTimestamp")}})).bind({});Default.args={}},"./src/app/_services/formly/validators.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Be:()=>requiredIconMessage,Bo:()=>fieldsDontMatchMessage,Bw:()=>requiredMessage,Ds:()=>hasSpecialCharactersMessage,K7:()=>requiredIconValidator,Kg:()=>sessionAuthorUniqueValidator,U3:()=>iconValidator,UP:()=>invalidTimeMessage,YM:()=>timeValidator,_7:()=>fieldMatchValidator,cc:()=>specialCharacterValidator,eS:()=>sessionAlreadyHasAuthor,l$:()=>notIntegerMessage,np:()=>requiredValidator,ol:()=>dateMessage,sm:()=>dateValidator,ud:()=>faPrefixMessage,x5:()=>integerValidator});var _home_runner_work_nimstoryfont_gui_nimstoryfont_gui_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js");const invalidTimeMessage={name:"time",message:"Time must have 'hh:mm:ss' pattern"},requiredMessage={name:"required",message:"This field is required!"},dateMessage={name:"date",message:"This date does not follow the pattern: 'YYYY-MM-DD'. Sorry to be such a Nazi about it. The computer is forcing me."},requiredIconMessage={name:"requiredIcon",message:"This field requires a fontawesome icon as input. Here is a list of them: https://fontawesome.com/v4.7.0/icons/"},faPrefixMessage={name:"faPrefix",message:"Icons are stored without the 'fa-' from font-awesome prefix"},notIntegerMessage={name:"notInteger",message:"Your input is not an integer. This field requires an integer number. No amount of revolution can overcome this."},hasSpecialCharactersMessage={name:"hasSpecialCharacters",message:'Your input includes one of the following invalid special characters: [ ] ( ) ? | \\ " % ~ # < > :. If you need to rebel, please dont against this.'},fieldsDontMatchMessage={name:"fieldMatch",message:"Password Not Matching"},sessionAlreadyHasAuthor={name:"isInvalidSessionAuthorPair",message:"\n    The author you selected already has a diaryentry in the session you selected. You \n    can't have 2 diaryentries from the same author in the same session. Consider writing \n    your diaryentry as an encounter instead into the diaryentry at the spot you just considered."};const timeValidator={name:"time",validation:function timeValidation(control){const isValidTime=/\d\d.[0-5]\d.[0-5]\d/.test(control.value);return isValidTime?null:{time:!isValidTime}}};function requiredValidation(control){return!!control.value||0===control.value?null:{required:!0}}const requiredValidator={name:"required",validation:requiredValidation},requiredIconValidator={name:"requiredIcon",validation:requiredValidation};const dateValidator={name:"date",validation:function dateValidation(control){return/[1-2]\d{3}-(0\d|1[0-2])-[0-3]\d/.test(control.value)?null:{date:!0}}};const iconValidator={name:"faPrefix",validation:function iconValidation(control){const hasFaPrefix=/fa-/.test(control.value);return hasFaPrefix?null:{faPrefix:hasFaPrefix}}};const integerValidator={name:"notInteger",validation:function isIntegerValidation(control){const isInteger="number"==typeof control.value&&Number.isInteger(control.value);return isInteger?null:{notInteger:!isInteger}}};const specialCharacterValidator={name:"hasSpecialCharacters",validation:function hasNoSpecialCharactersValidation(control){if("string"==typeof control.value){const specialCharacters=["[","]","(",")","|","\\",'"',"%","~","#","<",">","?","/",":"];for(const specialCharacter of specialCharacters)if(control.value.includes(specialCharacter))return{hasSpecialCharacters:!0}}return null}};const fieldMatchValidator={name:"fieldMatch",validation:function passwordMatchValidation(control){const{password,passwordConfirm}=control.value;return passwordConfirm&&password?passwordConfirm===password?{passwordMatch:!0}:null:{passwordMatch:!0}}};function _isSessionAuthorPairUniqueValidator(){return(_isSessionAuthorPairUniqueValidator=(0,_home_runner_work_nimstoryfont_gui_nimstoryfont_gui_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(control){const{session:selectedSessionId,author:selectedAuthorId}=control.value,selectFieldOptionsObs=control.controls.session._fields[0].templateOptions.options,selectedOption=(yield selectFieldOptionsObs.toPromise()).find((option=>option.pk===selectedSessionId));if(null==selectedOption)throw"WeirdError. You selected a session, its id got into the model and somehow that field is no longer among the options (?)";const selectedAuthorAlreadyHasDiaryentryOnSession=selectedOption.author_ids.includes(selectedAuthorId),isInitialValue=control.pristine;return selectedAuthorAlreadyHasDiaryentryOnSession&&!isInitialValue?{passwordMatch:{message:"That account already has a diaryentry written for that session. Accounts can only have one Diaryentry per session"}}:{passwordMatch:null}}))).apply(this,arguments)}const sessionAuthorUniqueValidator={name:"sessionAuthorPairUnique",validation:function isSessionAuthorPairUniqueValidator(_x){return _isSessionAuthorPairUniqueValidator.apply(this,arguments)}}},"./src/app/design/organisms/player/player.component.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{l:()=>PlayerComponent});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.js");var _class,player_componentngResource=__webpack_require__("./src/app/design/organisms/player/player.component.scss?ngResource"),player_componentngResource_default=__webpack_require__.n(player_componentngResource),core=__webpack_require__("./node_modules/@angular/core/fesm2020/core.mjs"),plyr_min=__webpack_require__("./node_modules/plyr/dist/plyr.min.js");let PlayerComponent=((_class=class PlayerComponent{constructor(){this.SEEK_TIME=5,this.VOLUME_STEP=.05}ngOnInit(){this.plyr=new plyr_min(this.audioPlayer.nativeElement,{controls:["play","progress","current-time","mute","volume","download","settings"],invertTime:!1,seekTime:this.SEEK_TIME,volume:0}),this.plyr.download=this.downloadSource,this.setPlayTime()}ngOnChanges(){this.setPlayTime()}setPlayTime(){null!=this.playTime&&(this.plyr.currentTime=this.playTime)}triggerHotkeyAction(keyPressEvent){switch(keyPressEvent.code){case"Space":case"Enter":this.play();break;case"KeyM":this.mute();break;case"ArrowRight":this.seekForward();break;case"ArrowLeft":this.seekBackward()}}play(){this.plyr.togglePlay()}seekBackward(){this.plyr.rewind(this.SEEK_TIME)}seekForward(){this.plyr.forward(this.SEEK_TIME)}increaseVolume(){this.plyr.increaseVolume(this.VOLUME_STEP)}decreaseVolume(){this.plyr.decreaseVolume(this.VOLUME_STEP)}mute(){this.plyr.muted=!this.plyr.muted}}).propDecorators={serverUrl:[{type:core.Input}],audioSource:[{type:core.Input}],downloadSource:[{type:core.Input}],playTime:[{type:core.Input}],audioPlayer:[{type:core.ViewChild,args:["audioPlayer",{static:!0}]}]},_class);PlayerComponent=(0,tslib_es6.gn)([(0,core.Component)({selector:"app-player",template:'<audio #audioPlayer\n  (keydown)="triggerHotkeyAction($event)"\n  [src]="serverUrl + audioSource"\n  [preload]="\'metadata\'"\n  [controls]="false"\n></audio>\n',styles:[player_componentngResource_default()]})],PlayerComponent)},"./src/app/design/organisms/sessionaudio-player/sessionaudio-player.component.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{C:()=>SessionaudioPlayerComponent});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.js");var _class,sessionaudio_player_componentngResource=__webpack_require__("./src/app/design/organisms/sessionaudio-player/sessionaudio-player.component.scss?ngResource"),sessionaudio_player_componentngResource_default=__webpack_require__.n(sessionaudio_player_componentngResource),core=__webpack_require__("./node_modules/@angular/core/fesm2020/core.mjs"),fesm2020_forms=__webpack_require__("./node_modules/@angular/forms/fesm2020/forms.mjs"),formly_service_service=__webpack_require__("./src/app/_services/formly/formly-service.service.ts");let SessionaudioPlayerComponent=((_class=class SessionaudioPlayerComponent{constructor(formlyService){this.formlyService=formlyService,this.canDelete=!1,this.canCreate=!1,this.deleteTimestamp=new core.EventEmitter,this.createTimestamp=new core.EventEmitter,this.timestampState="DISPLAY",this.timestampForm=new fesm2020_forms.cw({}),this.timestampFields=[this.formlyService.buildInputConfig({key:"time",maxLength:8,minLength:8,className:"timestamp-input black-background px-0 col-lg-2 col-3",validators:["time"],required:!0,inputKind:"STRING"}),this.formlyService.buildInputConfig({key:"name",label:"Title",className:"timestamp-input black-background px-0 col-lg-10 col-9",required:!0,inputKind:"STRING"})],this.timestampModel={}}ngOnInit(){this.setTimestampEntries()}ngOnChanges(){this.setTimestampEntries()}changeTimestampState(newState){this.timestampState=newState}onLinkClick(timestamp){this.currentTime=timestamp.time,setTimeout((()=>this.currentTime=void 0),1)}onSubmit(timestamp){const time=this.stringToTime(timestamp.time),newTimestamp={name:timestamp.name,time,session_audio:this.sessionAudioPk};this.createTimestamp.emit(newTimestamp),this.timestampState="DISPLAY",this.timestamps.unshift(newTimestamp),this.ngOnChanges()}setTimestampEntries(){this.timestampEntries=this.timestamps.map((timestamp=>({value:timestamp,label:timestamp.name,linkText:this.timeToString(timestamp.time)})))}timeToString(seconds){const hours=Math.floor(seconds/3600),minutes=Math.floor((seconds-3600*hours)/60),remainingSeconds=Math.floor(seconds-3600*hours-60*minutes);return`${hours.toString().padStart(2,"0")}:${minutes.toString().padStart(2,"0")}:${remainingSeconds.toString().padStart(2,"0")}`}stringToTime(timeString){return 3600*parseInt(timeString.substr(0,2))+60*parseInt(timeString.substr(3,2))+parseInt(timeString.substr(6,2))}}).ctorParameters=()=>[{type:formly_service_service.T}],_class.propDecorators={sessionAudioPk:[{type:core.Input}],timestamps:[{type:core.Input}],serverUrl:[{type:core.Input}],audioSource:[{type:core.Input}],downloadSource:[{type:core.Input}],canDelete:[{type:core.Input}],canCreate:[{type:core.Input}],deleteTimestamp:[{type:core.Output}],createTimestamp:[{type:core.Output}]},_class);SessionaudioPlayerComponent=(0,tslib_es6.gn)([(0,core.Component)({selector:"app-sessionaudio-player",template:'<div class="container timestamp">\n  <div class="timestamp__image">\n    <img class="mw-100" [src]="\'/assets/default_images/audio_pic_default.webp\'"/>\n  </div>\n  <app-player\n    [serverUrl]="serverUrl"\n    [audioSource]="audioSource"\n    [downloadSource]="downloadSource"\n    [playTime]="currentTime"\n  ></app-player>\n\n  <ng-container *ngIf="canCreate">\n    <ng-container [ngSwitch]="timestampState">\n      <ng-container \n        *ngSwitchCase="\'DISPLAY\'"\n        [ngTemplateOutlet]="timestampDisplay"\n      ></ng-container>\n      <ng-container \n        *ngSwitchCase="\'CREATE\'"\n        [ngTemplateOutlet]="timestampCreate"\n      ></ng-container>\n    </ng-container>\n  </ng-container>\n\n  <div class="timestamp__list list">\n    <ng-container *ngFor="let entry of timestampEntries">\n      <app-link-entry\n        class="list__timestamp"\n        [canDelete]="canDelete"\n        [entry]="entry"\n        [columnSizes]="[3, 7, 2]"\n        [deleteMessage]="\'Delete timestamp \\\'\' + entry.linkText + \'\\\'?\'"\n        (delete)="deleteTimestamp.emit($event)"\n        (linkClick)="onLinkClick($event)"\n      ></app-link-entry>\n    </ng-container>\n  </div>\n</div>\n\n<ng-template #timestampDisplay>\n  <div class="row timestamp__create-button">\n    <app-button\n      class="col-12 col-md-6"\n      [type]="\'PRIMARY\'"\n      [text]="\'Add Timestamp\'"\n      [icon]="\'plus\'"\n      (click)="changeTimestampState(\'CREATE\')"\n    ></app-button>\n  </div>\n</ng-template>\n\n<ng-template #timestampCreate>\n  <app-card>\n    <h5 class="timestamp__create-form"> Create Timestamp </h5>\n    <app-form\n      [model]="timestampModel"\n      [fields]="timestampFields"\n      [cancelButtonType]="\'DARK\'"\n      (formlySubmit)="onSubmit($event)"\n      (formlyCancel)="changeTimestampState(\'DISPLAY\')"\n    ></app-form>\n  </app-card>\n</ng-template>',styles:[sessionaudio_player_componentngResource_default()]})],SessionaudioPlayerComponent)},"./node_modules/@storybook/addon-actions/dist/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{aD:()=>chunk_KKE3V3AL.aD});var chunk_KKE3V3AL=__webpack_require__("./node_modules/@storybook/addon-actions/dist/chunk-KKE3V3AL.mjs");__webpack_require__("./node_modules/@storybook/addon-actions/dist/chunk-VWCVBQ22.mjs")},"./src/app/design/organisms/player/player.component.scss?ngResource":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_EXPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.push([module.id,"",""]),module.exports=___CSS_LOADER_EXPORT___.toString()},"./src/app/design/organisms/sessionaudio-player/sessionaudio-player.component.scss?ngResource":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_EXPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.push([module.id,".timestamp__list {\n  margin-top: var(--spacer-3);\n}\n.timestamp__create-button {\n  justify-content: center;\n  margin-top: var(--spacer-3);\n}\n.timestamp__create-form {\n  width: 100%;\n  text-align: center;\n  font-weight: bold;\n}\n\n.list__timestamp {\n  padding-bottom: var(--spacer-1);\n  display: block;\n}\n\n.container {\n  padding-left: var(--spacer-0);\n  padding-right: var(--spacer-0);\n}",""]),module.exports=___CSS_LOADER_EXPORT___.toString()}}]);